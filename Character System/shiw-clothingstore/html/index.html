<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Магазин одежды</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Philosopher:ital,wght@0,400;0,700;1,400;1,700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --red: #8B0000;
            --red-light: #A52A2A;
            --red-dark: #5C0000;
            --black: #0a0a0a;
            --black-light: #1a1a1a;
            --gray-dark: #2a2a2a;
            --gray: #5a5044;
            --gray-light: #7a6e5d;
            --white: #e0d7c6;
            --white-dim: #b8a88a;
            --green: #2a6a2a;
            --gold: #c9a227;
        }

        body {
            font-family: 'Philosopher', 'Times New Roman', Times, serif;
            background: transparent;
            color: var(--white);
            overflow: hidden;
            user-select: none;
        }

        #app {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
        }
        
        #app.visible { display: block; }

        /* ЛЕВАЯ ПАНЕЛЬ */
        .left-panel {
            position: absolute;
            left: 0;
            top: 0;
            width: 320px;
            height: 100vh;
            background: linear-gradient(90deg, rgba(10,10,10,0.98) 0%, rgba(10,10,10,0.95) 80%, rgba(10,10,10,0) 100%);
            display: flex;
            flex-direction: column;
        }

        .panel-title {
            padding: 40px 25px 20px;
            border-bottom: 1px solid var(--gray-dark);
        }

        .panel-title h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--white);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 5px;
        }

        .panel-title .subtitle {
            font-size: 14px;
            color: var(--gray-light);
            letter-spacing: 2px;
        }

        .player-money {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            font-size: 18px;
            color: var(--green);
        }

        .red-line {
            height: 2px;
            background: linear-gradient(90deg, var(--red) 0%, var(--red-dark) 70%, transparent 100%);
        }

        .menu-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .menu-content::-webkit-scrollbar { width: 3px; }
        .menu-content::-webkit-scrollbar-track { background: var(--black); }
        .menu-content::-webkit-scrollbar-thumb { background: var(--gray-light); }

        .menu-section-title {
            font-size: 11px;
            color: var(--gray-light);
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 15px 25px 10px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 25px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .menu-item:hover { background: rgba(139, 0, 0, 0.15); }
        .menu-item.active { background: rgba(139, 0, 0, 0.25); }
        .menu-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--red);
        }

        .menu-label {
            flex: 1;
            font-size: 15px;
            letter-spacing: 1px;
        }

        .menu-count {
            font-size: 12px;
            color: var(--gray-light);
            background: var(--gray-dark);
            padding: 2px 8px;
            border-radius: 0;
        }

        .panel-footer {
            padding: 15px 25px;
            border-top: 1px solid var(--gray-dark);
        }

        .footer-btns { display: flex; gap: 10px; }

        .btn {
            flex: 1;
            padding: 12px 15px;
            font-family: inherit;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-back { background: var(--gray-dark); color: var(--white); }
        .btn-back:hover { background: var(--gray); }
        .btn-buy { background: var(--green); color: var(--white); }
        .btn-buy:hover { background: #5a9c2a; }

        /* ПРАВАЯ ПАНЕЛЬ */
        .right-panel {
            position: absolute;
            right: 0;
            top: 0;
            width: 380px;
            height: 100vh;
            background: linear-gradient(270deg, rgba(10,10,10,0.98) 0%, rgba(10,10,10,0.95) 80%, rgba(10,10,10,0) 100%);
            display: none;
            flex-direction: column;
        }

        .right-panel.visible { display: flex; }

        .settings-header {
            padding: 40px 25px 20px;
            border-bottom: 1px solid var(--gray-dark);
        }

        .settings-header h2 {
            font-size: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .settings-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .settings-content::-webkit-scrollbar { width: 3px; }
        .settings-content::-webkit-scrollbar-track { background: var(--black); }
        .settings-content::-webkit-scrollbar-thumb { background: var(--gray-light); }

        .control-group { margin-bottom: 25px; }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .control-label .name { font-size: 14px; color: var(--white-dim); }
        .control-label .value { font-size: 14px; color: var(--red); font-weight: 600; }

        .slider-row { display: flex; align-items: center; gap: 10px; }

        .slider-btn {
            width: 32px;
            height: 32px;
            background: var(--gray-dark);
            border: none;
            color: var(--white);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slider-btn:hover { background: var(--red); }

        input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            height: 4px;
            background: var(--gray-dark);
            border-radius: 2px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--red);
            border-radius: 50%;
            cursor: pointer;
        }

        .item-info-box {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid var(--gray-dark);
            padding: 15px;
            margin-top: 20px;
        }

        .item-name { font-size: 18px; color: var(--white); margin-bottom: 8px; }
        .item-price { font-size: 22px; color: var(--green); font-weight: 700; }
        .item-price.expensive { color: var(--red); }

        /* НИЖНЯЯ ПАНЕЛЬ */
        .bottom-panel {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .selected-item-display {
            background: rgba(10, 10, 10, 0.9);
            border: 1px solid var(--gray-dark);
            padding: 12px 30px;
            text-align: center;
            min-width: 300px;
        }

        .selected-item-name { font-size: 16px; color: var(--white); margin-bottom: 5px; }
        .selected-item-price { font-size: 20px; color: var(--green); font-weight: 700; }

        .camera-controls { display: flex; gap: 8px; }

        .camera-btn {
            width: 45px;
            height: 45px;
            background: rgba(10, 10, 10, 0.9);
            border: 1px solid var(--gray-dark);
            color: var(--white);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .camera-btn:hover {
            background: rgba(139, 0, 0, 0.5);
            border-color: var(--red);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 10, 10, 0.95);
            border: 2px solid var(--red);
            padding: 30px 50px;
            text-align: center;
            z-index: 1000;
            display: none;
        }

        .notification.visible { display: block; animation: fadeIn 0.3s ease; }
        .notification.success { border-color: var(--green); }
        .notification.error { border-color: var(--red); }
        .notification-text { font-size: 18px; color: var(--white); }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="left-panel">
            <div class="panel-title">
                <h1 id="store-name">Магазин одежды</h1>
                <div class="subtitle">КАТАЛОГ ТОВАРОВ</div>
                <div class="player-money">
                    <span>$</span>
                    <span id="player-cash">0.00</span>
                </div>
            </div>
            <div class="red-line"></div>
            
            <div class="menu-content">
                <div class="menu-section-title">Категории</div>
                <div id="categories-list"></div>
            </div>
            
            <div class="panel-footer">
                <div class="footer-btns">
                    <button class="btn btn-back" onclick="App.closeStore()">Выход</button>
                    <button class="btn btn-buy" onclick="App.buyItem()">Купить</button>
                </div>
            </div>
        </div>

        <div class="right-panel" id="right-panel">
            <div class="settings-header">
                <h2 id="category-title">Товары</h2>
            </div>
            <div class="red-line"></div>
            
            <div class="settings-content">
                <div id="items-controls"></div>
                <div class="item-info-box" id="item-info">
                    <div class="item-name" id="info-name">Выберите товар</div>
                    <div class="item-price" id="info-price">$0.00</div>
                </div>
            </div>
        </div>

        <div class="bottom-panel">
            <div class="selected-item-display" id="selected-display">
                <div class="selected-item-name" id="display-name">Ничего не выбрано</div>
                <div class="selected-item-price" id="display-price"></div>
            </div>
            
            <div class="camera-controls">
                <button class="camera-btn" onclick="App.moveCamera('up')">▲</button>
                <button class="camera-btn" onclick="App.moveCamera('down')">▼</button>
                <button class="camera-btn" onclick="App.moveCamera('left')">◄</button>
                <button class="camera-btn" onclick="App.moveCamera('right')">►</button>
                <button class="camera-btn" onclick="App.moveCamera('reset')">⊙</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <div class="notification-text" id="notification-text"></div>
    </div>

    <script>
        const App = {
            isOpen: false,
            categories: {},
            items: [],
            selectedCategory: null,
            selectedItemIndex: 0,
            currentItem: null,
            playerMoney: 0,
            
            categoryNames: {
                'hats': 'Головные уборы',
                'coats': 'Пальто и куртки',
				'coats_closed': 'Закрытое пальто',
                'vests': 'Жилеты',
                'shirts_full': 'Рубашки',
                'pants': 'Штаны',
                'boots': 'Обувь',
                'chaps': 'Чапсы',
                'gloves': 'Перчатки',
                'neckwear': 'Шейные платки',
                'suspenders': 'Подтяжки',
                'belts': 'Ремни',
				'beltbuckle': 'Пряжка',
                'gunbelts': 'Кобуры',
                'holsters_left': 'Кобура (лево)',
                'holsters_right': 'Кобура (право)',
                'accessories': 'Аксессуары',
                'masks': 'Маски',
                'eyewear': 'Очки',
                'cloaks': 'Накидки',
                'ponchos': 'Пончо',
                'skirts': 'Юбки',
                'spurs': 'Шпоры',
                'gauntlets': 'Наручи',
                'neckties': 'Галстуки',
                'dresses': 'Платья',
				'hair_accessories': 'Украшения для волос',
                'boot_accessories': 'Аксессуары для обуви',
                'earrings': 'Серьги',
                'corsets': 'Корсеты',
                'rings_rh': 'Кольца (правая рука)',
                'rings_lh': 'Кольца (левая рука)',
                'bracelets': 'Браслеты',
                'necklaces': 'Ожерелья',
                'jewelry_rings_right': 'Кольца (правая рука)',
                'jewelry_rings_left': 'Кольца (левая рука)',
                'jewelry_bracelets': 'Браслеты'
            },
            
            init: function(data) {
                this.isOpen = true;
                this.items = data.items || [];
                this.playerMoney = data.money || 0;
                this.selectedCategory = null;
                this.selectedItemIndex = 0;
                this.currentItem = null;
                
                document.getElementById('store-name').textContent = data.storeName || 'Магазин одежды';
                document.getElementById('player-cash').textContent = this.playerMoney.toFixed(2);
                
                this.buildCategories();
                this.renderCategories();
                
                document.getElementById('app').classList.add('visible');
                document.getElementById('right-panel').classList.remove('visible');
            },
            
buildCategories: function() {
    // ✅ Список исключённых категорий
    const excludedCategories = [
        'belt_buckles',
        'talisman_belt',
        'talisman_holster',
        'loadouts',
        'satchels',
        'talisman_wrist'
    ];
    
    this.categories = {};
    for (let item of this.items) {
        const cat = item.category || 'other';
        
        // ✅ Пропускаем исключённые категории
        if (excludedCategories.includes(cat)) {
            continue;
        }
        
        if (!this.categories[cat]) this.categories[cat] = [];
        this.categories[cat].push(item);
    }
    // ★ Сортировка предметов по цене (от меньшего к большему)
    for (const cat of Object.keys(this.categories)) {
        this.categories[cat].sort((a, b) => (a.price || 0) - (b.price || 0));
    }
},
            
            renderCategories: function() {
                const container = document.getElementById('categories-list');
                container.innerHTML = '';
                
                const sortedCats = Object.keys(this.categories).sort((a, b) => {
                    return (this.categoryNames[a] || a).localeCompare(this.categoryNames[b] || b, 'ru');
                });
                
                for (let cat of sortedCats) {
                    const items = this.categories[cat];
                    const div = document.createElement('div');
                    div.className = 'menu-item' + (this.selectedCategory === cat ? ' active' : '');
                    div.innerHTML = `
                        <span class="menu-label">${this.categoryNames[cat] || cat}</span>
                        <span class="menu-count">${items.length}</span>
                    `;
                    div.onclick = () => this.selectCategory(cat);
                    container.appendChild(div);
                }
            },
            
            selectCategory: function(category) {
                this.selectedCategory = category;
                this.selectedItemIndex = 0;
                
                this.renderCategories();
                this.renderItemsSlider();
                
                document.getElementById('category-title').textContent = this.categoryNames[category] || category;
                document.getElementById('right-panel').classList.add('visible');
                
                this.applyCurrentItem();
            },
            
            renderItemsSlider: function() {
                const container = document.getElementById('items-controls');
                container.innerHTML = '';
                
                const items = this.categories[this.selectedCategory] || [];
                if (items.length === 0) return;
                
                const group = document.createElement('div');
                group.className = 'control-group';
                group.innerHTML = `
                    <div class="control-label">
                        <span class="name">Вариант</span>
                        <span class="value" id="item-counter">${this.selectedItemIndex + 1} / ${items.length}</span>
                    </div>
                    <div class="slider-row">
                        <button class="slider-btn" onclick="App.prevItem()">◄</button>
                        <input type="range" id="item-slider" min="0" max="${items.length - 1}" value="${this.selectedItemIndex}" oninput="App.onSliderChange(this.value)">
                        <button class="slider-btn" onclick="App.nextItem()">►</button>
                    </div>
                `;
                container.appendChild(group);
                this.updateItemInfo();
            },
            
            onSliderChange: function(value) {
                this.selectedItemIndex = parseInt(value);
                this.applyCurrentItem();
                this.updateItemInfo();
            },
            
            prevItem: function() {
                const items = this.categories[this.selectedCategory] || [];
                if (items.length === 0) return;
                this.selectedItemIndex = this.selectedItemIndex > 0 ? this.selectedItemIndex - 1 : items.length - 1;
                document.getElementById('item-slider').value = this.selectedItemIndex;
                this.applyCurrentItem();
                this.updateItemInfo();
            },
            
            nextItem: function() {
                const items = this.categories[this.selectedCategory] || [];
                if (items.length === 0) return;
                this.selectedItemIndex = this.selectedItemIndex < items.length - 1 ? this.selectedItemIndex + 1 : 0;
                document.getElementById('item-slider').value = this.selectedItemIndex;
                this.applyCurrentItem();
                this.updateItemInfo();
            },
            
            updateItemInfo: function() {
                const items = this.categories[this.selectedCategory] || [];
                if (items.length === 0) return;
                
                const item = items[this.selectedItemIndex];
                this.currentItem = item;
                
                document.getElementById('item-counter').textContent = `${this.selectedItemIndex + 1} / ${items.length}`;
                document.getElementById('info-name').textContent = item.name;
                document.getElementById('info-price').textContent = '$' + item.price.toFixed(2);
                document.getElementById('info-price').classList.toggle('expensive', item.price > this.playerMoney);
                document.getElementById('display-name').textContent = item.name;
                document.getElementById('display-price').textContent = '$' + item.price.toFixed(2);
            },
            
            applyCurrentItem: function() {
                const items = this.categories[this.selectedCategory] || [];
                if (items.length === 0) return;
                
                const item = items[this.selectedItemIndex];
                this.currentItem = item;
                
                fetch('https://rsg-clothingstore/previewItem', {
                    method: 'POST',
                    body: JSON.stringify({ item: item })
                });
            },
            
            buyItem: function() {
                if (!this.currentItem) {
                    this.showNotification('Сначала выберите товар', 'error');
                    return;
                }
                if (this.playerMoney < this.currentItem.price) {
                    this.showNotification('Недостаточно денег', 'error');
                    return;
                }
                fetch('https://rsg-clothingstore/buyItem', {
                    method: 'POST',
                    body: JSON.stringify({ item: this.currentItem })
                });
            },
            
            purchaseSuccess: function(data) {
                this.playerMoney = data.newMoney || this.playerMoney;
                document.getElementById('player-cash').textContent = this.playerMoney.toFixed(2);
                this.showNotification('Покупка совершена!', 'success');
                this.updateItemInfo();
            },
            
            purchaseFailed: function(reason) {
                this.showNotification(reason || 'Ошибка покупки', 'error');
            },
            
            showNotification: function(text, type) {
                const notif = document.getElementById('notification');
                notif.className = 'notification visible ' + (type || '');
                document.getElementById('notification-text').textContent = text;
                setTimeout(() => notif.classList.remove('visible'), 2000);
            },
            
            moveCamera: function(direction) {
                fetch('https://rsg-clothingstore/moveCamera', {
                    method: 'POST',
                    body: JSON.stringify({ direction: direction })
                });
            },
            
            closeStore: function() {
                this.isOpen = false;
                document.getElementById('app').classList.remove('visible');
                fetch('https://rsg-clothingstore/closeStore', {
                    method: 'POST',
                    body: JSON.stringify({})
                });
            }
        };
        
        window.addEventListener('message', function(event) {
            const data = event.data;
            switch (data.action) {
                case 'open': App.init(data); break;
                case 'close': App.closeStore(); break;
                case 'updateMoney':
                    App.playerMoney = data.money;
                    document.getElementById('player-cash').textContent = data.money.toFixed(2);
                    break;
                case 'purchaseSuccess': App.purchaseSuccess(data); break;
                case 'purchaseFailed': App.purchaseFailed(data.reason); break;
            }
        });
        
        document.addEventListener('keydown', function(event) {
            if (!App.isOpen) return;
            switch (event.key) {
                case 'ArrowLeft': event.preventDefault(); App.prevItem(); break;
                case 'ArrowRight': event.preventDefault(); App.nextItem(); break;
                case 'e': case 'E': case 'Enter': event.preventDefault(); App.buyItem(); break;
                case 'Escape': case 'Backspace': event.preventDefault(); App.closeStore(); break;
            }
        });
    </script>
</body>
</html>
